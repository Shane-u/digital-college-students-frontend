# å›¾å½¢éªŒè¯ç æ¥å£ä¿®å¤è¯´æ˜

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. Base64æ ¼å¼æ”¯æŒ
- åç«¯è¿”å›çš„éªŒè¯ç æ ¼å¼ä¸ºï¼š`data:image/png;base64,iVBORw0KG...`
- ä¿®æ”¹äº† `getCaptcha()` æ–¹æ³•ï¼Œç›´æ¥è·å–JSONå“åº”ä¸­çš„dataå­—æ®µ
- è‡ªåŠ¨æ£€æµ‹æ˜¯å¦åŒ…å«`data:image`å‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰åˆ™è‡ªåŠ¨æ·»åŠ 

### 2. ç®€åŒ–APIè°ƒç”¨
- ç§»é™¤äº†blobå’Œarraybufferçš„å¤æ‚å¤„ç†
- ç›´æ¥ä½¿ç”¨æ ‡å‡†çš„JSONå“åº”æ ¼å¼
- é€šè¿‡axiosæ‹¦æˆªå™¨è‡ªåŠ¨æå–response.data

### 3. è°ƒè¯•å¢å¼º
- æ·»åŠ äº†è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—
- æ˜¾ç¤ºå®Œæ•´çš„å“åº”æ•°æ®
- æ˜¾ç¤ºé”™è¯¯è¯¦æƒ…

## ğŸ“‹ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: CORSè·¨åŸŸé—®é¢˜
**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º "Access-Control-Allow-Origin" é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. åç«¯éœ€è¦è®¾ç½®CORSå¤´ï¼š
```java
response.setHeader("Access-Control-Allow-Origin", "*");
response.setHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
response.setHeader("Access-Control-Allow-Headers", "Content-Type");
```

2. æˆ–è€…åœ¨nginxä¸­é…ç½®ï¼š
```nginx
add_header 'Access-Control-Allow-Origin' '*';
add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
```

### é—®é¢˜2: åç«¯è¿”å›æ ¼å¼é”™è¯¯
**ç—‡çŠ¶**: response.dataä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯è¿”å›çš„JSONæ ¼å¼ï¼š
```json
{
  "code": 0,
  "data": "data:image/png;base64,iVBORw0KG...",
  "message": "success"
}
```

2. ç¡®ä¿dataå­—æ®µåŒ…å«å®Œæ•´çš„base64å›¾ç‰‡æ•°æ®

### é—®é¢˜3: ç½‘ç»œè¶…æ—¶
**ç—‡çŠ¶**: è¯·æ±‚è¶…è¿‡10ç§’æ²¡æœ‰å“åº”

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥IPåœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
3. å°è¯•åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼š`http://192.168.147.38:8121/api/user/captcha`

## ğŸ§ª æµ‹è¯•å·¥å…·

é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª `test-captcha.html` æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•éªŒè¯ç æ¥å£ï¼š

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `test-captcha.html`
2. ç‚¹å‡»ä¸åŒçš„æµ‹è¯•æŒ‰é’®
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºå’Œå›¾ç‰‡æ˜¾ç¤º

### æµ‹è¯•æ–¹æ³•ï¼š
- **æµ‹è¯•1**: Blobæ ¼å¼ - æ ‡å‡†æ–¹å¼
- **æµ‹è¯•2**: Base64æ ¼å¼ - å¤‡ç”¨æ–¹å¼
- **æµ‹è¯•3**: ç›´æ¥æ˜¾ç¤º - æœ€ç®€å•æ–¹å¼

## ğŸ” è°ƒè¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
æŒ‰ F12 æˆ–å³é”® -> æ£€æŸ¥

### 2. æŸ¥çœ‹Consoleæ ‡ç­¾
æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š
```
å¼€å§‹è¯·æ±‚éªŒè¯ç ...
è·å–éªŒè¯ç æˆåŠŸ: { code: 0, data: "data:image/png;base64,iVBORw0KG...", message: "success" }
éªŒè¯ç å·²è®¾ç½®ï¼ˆå®Œæ•´base64ï¼‰
```

### 3. æŸ¥çœ‹Networkæ ‡ç­¾
1. åˆ·æ–°é¡µé¢
2. æ‰¾åˆ° `/user/captcha` è¯·æ±‚
3. æ£€æŸ¥ï¼š
   - Status: åº”è¯¥æ˜¯ 200
   - Type: åº”è¯¥æ˜¯ xhr æˆ– json
   - Response: åº”è¯¥åŒ…å«dataå­—æ®µå’Œbase64æ•°æ®

### 4. å¸¸è§é”™è¯¯ç 
- **404**: æ¥å£è·¯å¾„é”™è¯¯
- **500**: åç«¯æœåŠ¡é”™è¯¯
- **CORS error**: è·¨åŸŸé—®é¢˜
- **timeout**: ç½‘ç»œè¶…æ—¶

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### src/api/userApi.js
```javascript
// è·å–å›¾å½¢éªŒè¯ç ï¼ˆåç«¯è¿”å›base64æ ¼å¼ï¼‰
getCaptcha() {
  return api.get('/user/captcha')
}
```

### src/views/LoginPage.vue
```javascript
// è·å–å›¾å½¢éªŒè¯ç ï¼ˆåç«¯è¿”å›base64æ ¼å¼ï¼‰
const getCaptchaImage = async () => {
  try {
    console.log('å¼€å§‹è¯·æ±‚éªŒè¯ç ...');
    const response = await userApi.getCaptcha();
    console.log('è·å–éªŒè¯ç æˆåŠŸ:', response);
    
    // åç«¯è¿”å›çš„dataå­—æ®µåŒ…å«base64æ ¼å¼çš„å›¾ç‰‡æ•°æ®
    if (response && response.data) {
      // æ£€æŸ¥æ˜¯å¦å·²ç»åŒ…å«data:imageå‰ç¼€
      if (response.data.startsWith('data:image')) {
        captchaImage.value = response.data;
      } else {
        // å¦‚æœæ²¡æœ‰å‰ç¼€ï¼Œæ·»åŠ å‰ç¼€
        captchaImage.value = `data:image/png;base64,${response.data}`;
      }
    }
  } catch (error) {
    console.error('è·å–éªŒè¯ç å¤±è´¥:', error);
  }
};
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

1. å¯åŠ¨åç«¯æœåŠ¡ï¼Œç¡®ä¿è¿è¡Œåœ¨ `http://192.168.147.38:8121`
2. å¯åŠ¨å‰ç«¯é¡¹ç›®ï¼š`npm run dev`
3. æ‰“å¼€ç™»å½•é¡µé¢
4. éªŒè¯ç åº”è¯¥è‡ªåŠ¨åŠ è½½
5. ç‚¹å‡»éªŒè¯ç å›¾ç‰‡å¯ä»¥åˆ·æ–°

## âš ï¸ æ³¨æ„äº‹é¡¹

1. å¦‚æœæ›´æ”¹äº†åç«¯IPåœ°å€ï¼Œéœ€è¦ä¿®æ”¹ï¼š
   - `src/api/userApi.js` ä¸­çš„ baseURL

2. ç¡®ä¿åç«¯æ¥å£è·¯å¾„ä¸º `/api/user/captcha`

3. åç«¯è¿”å›çš„JSONæ ¼å¼åº”è¯¥åŒ…å«ï¼š
   - code: çŠ¶æ€ç ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼‰
   - data: base64æ ¼å¼çš„å›¾ç‰‡æ•°æ®
   - message: æ¶ˆæ¯

## ğŸ“ å¦‚æœè¿˜æœ‰é—®é¢˜

1. ä½¿ç”¨ `test-captcha.html` æµ‹è¯•æ¥å£
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—
3. æ£€æŸ¥Networkæ ‡ç­¾çš„è¯·æ±‚è¯¦æƒ…
4. ç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
5. å°è¯•ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®éªŒè¯ç URL

