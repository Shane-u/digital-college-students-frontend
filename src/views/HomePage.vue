<template>
  <div class="home-page">
    <MouseFollower />

    <!-- Navbar -->
    <nav class="navbar" :class="{ 'navbar-transparent': isNavTransparent }">
      <div class="nav-inner">
        <div class="nav-left">
          <div class="brand">
            <span class="brand-text">æ•°å­—å¤§å­¦ç”Ÿ</span>
          </div>
        </div>
        <div class="nav-center">
          <a href="#hero" class="nav-link bold">é¦–é¡µ</a>
          <a href="#competition" class="nav-link bold">ç«èµ›æ´»åŠ¨</a>
          <a href="#career" class="nav-link bold">èŒä¸šè§„åˆ’</a>
          <a href="#knowledge" class="nav-link bold">çŸ¥è¯†å›¾è°±</a>
          <a href="#profile" class="nav-link bold">ä¸ªäººä¸»é¡µ</a>
        </div>
        <div class="nav-right">
          <a href="#auth" class="nav-auth">ç™»å½•/æ³¨å†Œ</a>
        </div>
      </div>
    </nav>

    <!-- è½®æ’­å›¾å®¹å™¨ -->
    <div class="hero-slides">
      <div 
        class="slides-wrapper"
        :class="{ 'no-transition': !withTransition }"
       :style="{ transform: `translateX(-${currentIndex * 100}%)` }"
        @transitionend="onTransitionEnd"
      >
        <div  v-for="(img, i) in displaySlides" :key="i">
          <img :src="img" alt="è½®æ’­å›¾" class="slide-img" />
        </div>
        <!-- <div class="slide">
          <img src="../assets/pic_lb1.png" alt="" class="slide-img">
        </div> -->
      </div>
       
    </div>

    <!-- Heroå†…å®¹å±‚ï¼ˆæ–‡å­—ã€æŒ‰é’®ï¼‰ -->
    <section id="hero" ref="heroRef" class="hero-content-layer">
      <div class="hero-overlay"></div>
      <!-- <div class="hero-text">
        <h1 class="hero-title">æ•°å­—æ—¶ä»£çš„å¤§å­¦ç”Ÿæ´»</h1>
        <p class="hero-subtitle">æ¢ç´¢çŸ¥è¯†ï¼Œå‚ä¸ç«èµ›ï¼Œè§„åˆ’æœªæ¥ï¼Œäº«å—é’æ˜¥</p>
        <button class="hero-btn">å¼€å§‹æ¢ç´¢</button>
      </div> -->
      <div class="dino-group">
        <button
          v-for="(s, i) in slides"
          :key="`dino-${i}`"
          class="dino-btn"
          @click="goToSlide(i)"
          :title="`ç¬¬${i + 1}å¼ `"
        >
          ğŸ¦–
        </button>
      </div>
    </section>

    <div id="competition"
      class="section competition"
      :style="{ backgroundImage: `url(${background})` }">
      <!-- Competition Section -->
    <section>
      <div class="section-inner">
        <div class="section-title-wrap">
          <div class="cube-small"><Competition class="title-icon" /></div>
          <h2 class="section-title">ç«èµ›æ´»åŠ¨</h2>
        </div>
        <div class="cards">
          <div class="card">
            <div class="card-emoji">ğŸ†</div>
            <h3>ç¨‹åºè®¾è®¡å¤§èµ›</h3>
            <p>å¹´åº¦æœ€å¤§çš„ç¼–ç¨‹ç«èµ›ï¼Œå±•ç¤ºä½ çš„ç®—æ³•ä¸åˆ›é€ åŠ›</p>
          </div>
          <div class="card">
            <div class="card-emoji">ğŸ“Š</div>
            <h3>æ•°æ®ç§‘å­¦æŒ‘æˆ˜</h3>
            <p>ç”¨æ•°æ®è®²è¿°æ•…äº‹ï¼Œè§£å†³ç°å®ä¸–ç•Œçš„é—®é¢˜</p>
          </div>
          <div class="card">
            <div class="card-emoji">ğŸ¨</div>
            <h3>æ•°å­—è‰ºæœ¯å±•</h3>
            <p>å±•ç¤ºä½ çš„æ•°å­—è‰ºæœ¯ä½œå“ï¼Œèµ¢å¾—ä¸“ä¸šè¯„å®¡çš„è®¤å¯</p>
          </div>
        </div>
      </div>
      <div>

      </div>
    </section>

    <!-- Career Section -->
    <section id="career" class="section career">
      <div class="section-inner">
        <div class="section-title-wrap">
          <Astronaut class="title-icon astronaut-near" />
          <h2 class="section-title">èŒä¸šè§„åˆ’</h2>
        </div>
        <div class="career-grid">
          <div class="career-card">
            <h3 class="career-card-title">è¡Œä¸šå¯¼å¸ˆè®¡åˆ’</h3>
            <p class="career-card-text">è¿æ¥è¡Œä¸šä¸“å®¶ï¼Œè·å¾—ä¸€å¯¹ä¸€çš„èŒä¸šæŒ‡å¯¼</p>
            <ul class="career-list">
              <li>å®šåˆ¶åŒ–èŒä¸šå‘å±•è·¯å¾„</li>
              <li>è¡Œä¸šè¶‹åŠ¿ä¸æŠ€èƒ½åˆ†æ</li>
              <li>å®ä¹ ä¸å°±ä¸šæœºä¼šæ¨è</li>
            </ul>
          </div>
          <div class="career-card">
            <h3 class="career-card-title">æŠ€èƒ½å·¥ä½œåŠ</h3>
            <p class="career-card-text">æå‡èŒåœºç«äº‰åŠ›çš„å®ç”¨æŠ€èƒ½åŸ¹è®­</p>
            <div class="tag-grid">
              <span class="tag">ç®€å†ä¼˜åŒ–</span>
              <span class="tag">é¢è¯•æŠ€å·§</span>
              <span class="tag">èŒåœºæ²Ÿé€š</span>
              <span class="tag">æ—¶é—´ç®¡ç†</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    </div>
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted, computed } from "vue";
import MouseFollower from "../components/MouseFollower.vue";
import Astronaut from "../components/Astronaut.vue";
import pic1 from "../assets/pic_lb1.png";
import pic2 from "../assets/pic_lb2.png";
import pic3 from "../assets/pic_lb3.png";
import pic4 from "../assets/pic_lb4.png";
import background from "../assets/background.png";
import Competition from "../components/competition.vue";

export default {
  name: "HomePage",
  components: {
    MouseFollower,
    Competition,
    Astronaut,
  },
  setup() {
  const isNavTransparent = ref(true);
  const heroRef = ref(null);
   const currentIndex = ref(0); // è§†å›¾ç´¢å¼•ï¼ˆåŒ…å«å…‹éš†å¸§æ—¶ä½¿ç”¨ï¼‰
  const withTransition = ref(true);
  const pendingTargetIndex = ref(null); // æ‰‹åŠ¨ç‚¹å‡»æ—¶ç”¨äºåŒå‘ä¸æ»‘åˆ‡æ¢çš„ç›®æ ‡ç´¢å¼•
  let slideTimer = null;

  // è½®æ’­å›¾æ•°æ®ï¼šä¼˜å…ˆç”¨æœ¬åœ°å›¾ï¼Œæœ¬åœ°å›¾åŠ è½½å¤±è´¥åˆ™è‡ªåŠ¨åˆ‡æ¢åœ¨çº¿å›¾
  const slides = [
    pic4,
    pic2,
    pic3,
    pic1,
  ];

   // å±•ç¤ºç”¨æ•°ç»„ï¼šåœ¨æœ«å°¾å…‹éš†ç¬¬ä¸€å¼ ï¼Œä¾¿äºä»æœ«å¸§æ­£å¸¸åŠ¨ç”»åˆ°å…‹éš†å¸§
  const displaySlides = computed(() => {
    return slides.length > 0 ? [...slides, slides[0]] : [];
  });

   // æ ¹æ®è§†å›¾ç´¢å¼•æ¨å¯¼å½“å‰é€»è¾‘å¼ ï¼ˆç”¨äºæ¿€æ´»å°æé¾™ç­‰ï¼‰
   const currentSlide = computed(() => {
     if (!slides.length) return 0;
     return currentIndex.value % slides.length;
   });

  // ç›´æ¥è·³åˆ°æŒ‡å®šç´¢å¼•
  const goToSlide = (index) => {
    // å¸Œæœ›å§‹ç»ˆä¿æŒåŒæ–¹å‘ï¼ˆå‘å‰ï¼‰åˆ‡æ¢çš„è§†è§‰æ•ˆæœ
    const cur = currentSlide.value;
    if (index === cur) return;
    withTransition.value = true;
    // è‹¥ç›®æ ‡åœ¨å½“å‰ä¹‹åï¼Œåˆ™ç›´æ¥å‰è¿›åˆ°ç›®æ ‡
    if (index > cur) {
      currentIndex.value = index;
      return;
    }
    // è‹¥ç›®æ ‡åœ¨å½“å‰ä¹‹å‰ï¼Œåˆ™å…ˆå‰è¿›åˆ°å…‹éš†å¸§ï¼ˆæœ«å°¾+1ï¼‰ï¼Œç­‰å¾…è¿‡æ¸¡ç»“æŸåå½’ä½å¹¶å‰è¿›åˆ°ç›®æ ‡
    pendingTargetIndex.value = index;
    currentIndex.value = slides.length; // å…ˆå‰è¿›åˆ°å…‹éš†å¸§
  };

  // ä¸‹ä¸€å¼ è½®æ’­å›¾ï¼ˆä¿®å¤ï¼šä»æœ€åä¸€å¼ åˆ‡åˆ°å…‹éš†å¸§ï¼Œè¿‡æ¸¡åå½’ä½ç¬¬ä¸€å¼ ï¼‰
  const nextSlide = () => {
    withTransition.value = true;
    // å§‹ç»ˆå‰è¿›ä¸€å¸§ï¼›å½“åˆ°å…‹éš†å¸§ï¼ˆ=slides.lengthï¼‰æ—¶ï¼Œtransitionend ä¼šå½’ä½
    currentIndex.value += 1;
  };
   
  // ä¸Šä¸€å¼ è½®æ’­å›¾ï¼ˆæ–°å¢ï¼šä»ç¬¬ä¸€å¼ ç›´æ¥åˆ‡åˆ°æœ€åä¸€å¼ ï¼Œæ— éœ€è¿‡æ¸¡å…¶ä»–å›¾ç‰‡ï¼‰
   const prevSlide = () => {
     withTransition.value = true;
    if (currentIndex.value === 0) {
       // ä»ç¬¬ä¸€å¼ å¾€å›ï¼Œéœ€è¦ç¬æ—¶è·³åˆ°å…‹éš†å¸§å¯¹åº”ä½ç½®ï¼ˆæœ«å¼ ï¼‰å†è¿‡æ¸¡åˆ°å€’æ•°ç¬¬äºŒå¼ 
       // ç®€åŒ–ï¼šç›´æ¥è·³åˆ°æœ€åä¸€å¼ çœŸå®å›¾
       withTransition.value = false;
       currentIndex.value = slides.length; // å…‹éš†å¸§ä½ç½®
       requestAnimationFrame(() => {
         withTransition.value = true;
         currentIndex.value = slides.length - 1;
       });
     } else {
       currentIndex.value -= 1;
     }
   };

  // è‡ªåŠ¨è½®æ’­
  const startAutoSlide = () => {
    stopAutoSlide();
    slideTimer = setInterval(nextSlide, 5000);
  };

  // åœæ­¢è‡ªåŠ¨è½®æ’­
  const stopAutoSlide = () => {
    if (slideTimer) {
      clearInterval(slideTimer);
      slideTimer = null;
    }
  };

  onMounted(() => {
    // ç›‘å¬å¯¼èˆªæ é€æ˜åº¦ï¼ˆæ»šåŠ¨æ—¶åˆ‡æ¢ï¼‰
    const observer = new IntersectionObserver(
      (entries) => {
        const entry = entries[0];
        isNavTransparent.value = entry.isIntersecting;
      },
      { threshold: 0.2 }
    );
    if (heroRef.value) observer.observe(heroRef.value);

    // å¯åŠ¨è‡ªåŠ¨è½®æ’­
    startAutoSlide();

    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
    onUnmounted(() => {
      stopAutoSlide();
      if (observer && heroRef.value) observer.unobserve(heroRef.value);
    });
  });

  // è¿‡æ¸¡ç»“æŸæ—¶çš„æ”¶å°¾å¤„ç†ï¼šè‹¥åœ¨å…‹éš†å¸§ï¼Œç¬æ—¶æ— åŠ¨ç”»å½’ä½åˆ°ç¬¬ä¸€å¼ 
   const onTransitionEnd = () => {
    // å¦‚æœåˆšå¥½æ˜¯æœ€åä¸€å¼ 
    if (currentIndex.value === slides.length) {
      withTransition.value = false;
      // var con = document.querySelector(".slides-wrapper");
      // con.style.removeProperty('transition');
      // con.style.transitionDuration = '0s';
      // con.style.removeProperty("transform");
       currentIndex.value = 0;
       // æ¢å¤è¿‡æ¸¡ä¾›åç»­åˆ‡æ¢
       requestAnimationFrame(() => {
        //  con.style.transition = 'transform 1.5s ease';
        //  con.style.transform = "translateX(-${currentIndex * 100}%"
        //  con.style.transitionDuration = '1.5s';
        //  withTransition.value = true;
       });
     }
   };

  return {
    isNavTransparent,
    heroRef,
     currentSlide,
     currentIndex,
    nextSlide,
    prevSlide,
    goToSlide,
    withTransition,
    displaySlides,
    onTransitionEnd,
    slides,
    background,
  };
}
}
</script>

<style scoped>
/* å…¨å±€å®¹å™¨ */
.home-page {
  min-height: 100vh;
  background: #ffffff;
  position: relative;
  overflow-x: hidden;
}

/* å¯¼èˆªæ æ ·å¼ */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  background: linear-gradient(
    to bottom,
    rgba(30, 132, 248, 0.55),
    rgba(81, 163, 251, 0.28),
    rgba(134, 187, 248, 0)
  );
  box-shadow: none;
  transition: background 0.5s ease, box-shadow 0.4s ease;
  /* box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); */
}

.navbar-transparent {
  background: linear-gradient(
    to bottom,
    rgba(30, 132, 248, 0.55),
    rgba(81, 163, 251, 0.28),
    rgba(134, 187, 248, 0)
  );
  box-shadow: none;
}

.nav-inner {
  
  padding: 14px 20px ;
  display: flex;
  align-items: center;
}

.nav-left {
  width: 25%;
  display: flex;
  align-items: center;
}

.nav-center {
  width: 50%;
  display: flex;
  justify-content: center;
  gap: 36px;
  
}

.nav-right {
  width: 25%;
  display: flex;
  justify-content: flex-end;
  padding-right: 20px
}



.brand-text {
  color: #ffffff;
  font-weight: 700;
  font-size: 50px;
  letter-spacing: 1px;
}

.nav-link {
  color: #ffffff;
  text-decoration: none;
  font-weight: 700;
  letter-spacing: 0.3px;
  transition: color 0.2s ease;
  font-size: 20px;
}

.nav-link:hover {
  color: #cfe4ff;
}

.nav-auth {
  color: #ffffff;
  text-decoration: none;
  font-weight: 600;
  font-size: 20px;
}

/* è½®æ’­å›¾æ ·å¼ï¼ˆå…¨å±æ˜¾ç¤ºï¼‰ */
.hero-slides {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
  z-index: 1;
}

.slides-wrapper {
  display: flex;
  width: 100%;
  height: 100vh;
  transition: transform 1.5s ease;
  will-change: transform;
}

.no-transition {
  transition: none !important;
}

.slide {
  width: 100%;  /* ä½¿ç”¨è§†å£å®½åº¦ */
  height: 100vh; /* ä½¿ç”¨è§†å£é«˜åº¦ */
}

.slide-img {
  width: 98.9vw;
  height: 100vh;
  object-fit: cover;
  object-position: center;
}

/* Heroå†…å®¹å±‚ï¼ˆæ–‡å­—ã€æŒ‰é’®ï¼Œå åœ¨è½®æ’­å›¾ä¸Šï¼‰ */
.hero-content-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  z-index: 2;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding-top: 60px;
  box-sizing: border-box;
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.25);
  z-index: 1;
}

.hero-text {
  position: relative;
  z-index: 2;
  text-align: center;
  color: #ffffff;
}

.hero-title {
  font-size: 48px;
  font-weight: 800;
  margin-bottom: 12px;
}

.hero-subtitle {
  opacity: 0.9;
  font-size: 18px;
  margin-bottom: 24px;
}

.hero-btn {
  background: #ffd400;
  color: #1f2937;
  border: none;
  padding: 12px 26px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.2s ease;
}

.hero-btn:hover {
  background: #ffe033;
}

/* è½®æ’­å›¾æ§åˆ¶æŒ‰é’® */
.hero-controls {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 3;
  display: flex;
  gap: 14px;
}

.control-btn {
  background: rgba(255, 255, 255, 0.25);
  color: #fff;
  border: none;
  width: 38px;
  height: 38px;
  border-radius: 50%;
  backdrop-filter: blur(6px);
  cursor: pointer;
  transition: background 0.2s ease;
}

.control-btn:hover {
  background: rgba(255, 255, 255, 0.4);
}


.dino-group {
  position: absolute;
  right: 18px;
  bottom: 18px;
  z-index: 3;
  display: flex;
  gap: 10px;
}

.dino-btn {
  background: rgba(255, 255, 255, 0.28);
  border: none;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  backdrop-filter: blur(6px);
  cursor: pointer;
  font-size: 20px;
  transition: background 0.2s ease;
}

.dino-btn:hover {
  background: rgba(255, 255, 255, 0.4);
}

/* é€šç”¨ section æ ·å¼ */
.section {
  padding: 40px 0;
  position: relative;
  z-index: 3;
}

.section-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.section-title-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 28px;
}

.title-icon {
  width: 90px;
  height: 90px;
}

.cube-small {
  padding: -5px 22px 20px 0;
}

.section-title {
  font-size: 32px;
  font-weight: 800;
  color: #0b2a4a;
}

/* ç«èµ›æ¿å—æ ·å¼ */
.competition {
  background-size: cover;
  background-position: center;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 24px;
}

.card {
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(0, 0, 0, 0.06);
  border-radius: 8px;
  padding: 28px 22px;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
  transition: transform 0.25s ease;
}

.card:hover {
  transform: translateY(-4px);
}

.card-emoji {
  font-size: 28px;
  margin-bottom: 10px;
}

.card h3 {
  margin: 8px 0 6px;
  color: #0b2a4a;
  font-size: 18px;
}

.card p {
  color: #475569;
  line-height: 1.6;
}

/* èŒä¸šè§„åˆ’æ¿å—æ ·å¼ */
.career-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
}

.astronaut-near {
  width: 36px;
  height: 36px;
  transform: translateY(2px);
}

.career-card {
  background: #ffffff;
  border: 1px solid rgba(0, 0, 0, 0.06);
  border-radius: 8px;
  padding: 28px 22px;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.06);
}

.career-card-title {
  color: #0b2a4a;
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 8px;
}

.career-card-text {
  color: #475569;
  margin-bottom: 14px;
  line-height: 1.6;
}

.career-list {
  color: #334155;
  padding-left: 16px;
  display: grid;
  gap: 6px;
}

.career-list li {
  list-style: disc;
  line-height: 1.5;
}

.tag-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

.tag {
  background: #e0edff;
  color: #0a54e6;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 13px;
  text-align: center;
}

/* å“åº”å¼é€‚é…ï¼ˆå°å±å¹•ï¼‰ */
@media (max-width: 768px) {
  .nav-left,
  .nav-right {
    width: 30%;
  }

  .nav-center {
    width: 40%;
    gap: 18px;
  }

  .hero-title {
    font-size: 34px;
  }

  .hero-content-layer {
    padding-top: 50px;
  }

  .hero-slides {
    height: 100vh;
  }
}
</style>